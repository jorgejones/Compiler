Compiler

Needs revisiting and refractoring

